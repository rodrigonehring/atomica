# This references the default nodejs container from
# the Docker Hub: https://registry.hub.docker.com/_/node/
# If you want Nodesource's container you would reference nodesource/node
# Read more about containers on our dev center
# http://devcenter.wercker.com/docs/containers/index.html
box: node
# This is the build pipeline. Pipelines are the core of wercker
# Read more about pipelines on our dev center
# http://devcenter.wercker.com/docs/pipelines/index.html

# You can also use services such as databases. Read more on our dev center:
# http://devcenter.wercker.com/docs/services/index.html
# services:
    # - postgres
    # http://devcenter.wercker.com/docs/services/postgresql.html

    # - mongo
    # http://devcenter.wercker.com/docs/services/mongodb.html
# build:
#   # The steps that will be executed on build
#   # Steps make up the actions in your pipeline
#   # Read more about steps on our dev center:
#   # http://devcenter.wercker.com/docs/steps/index.html
#   steps:
#     # A step that executes `npm install` command
#     - npm-install
#     # A step that executes `npm test` command
#     - npm-test

#     # A custom script step, name value is used in the UI
#     # and the code value contains the command that get executed
#     - script:
#         name: echo nodejs information
#         code: |
#           echo "node version $(node -v) running"
#           echo "npm version $(npm -v) running"
# ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDqJVy+eFc0iI2n9gqQme0pQlWp9qHnS0BJkc5oyMtMcNaGX+GU6tZYlKeDf1Sj9WSlU6nEe2Qm5XfzVHwFWYgFufdmd6lpxt7yYx9IJX7SDUg3vaUmolYzx7viamUDR77t3VLZEHetSsartFKdldGUngNgQo5dpiGtE8uVxxiqYrspMHKP8SBwmv1YgXX/pbVoIDEWbfWEU9X6EGm3GrbHpTtRGvQQDqIBKe7ksdmhJ0gmddJwthggagP2b4L+R9b7u8oNMWYu4Dy0ub7eWpnikUhwaK2cYT7nVd082oaVBf6jH3RhoyNNg2S7hANO5MUsNia+5l+Hvd1lY0zQpUFT wercker / atomica / ev
build:
  steps:
    - wercker/add-ssh-key:
        keyname: DO
    - add-to-known_hosts:
        hostname: $REMOTE_HOST
    - script:
      name: $REMOTE_HOST
      code: ssh root@$REMOTE_HOST "cd app && npm stop"
    - script:
      name: git pull
      code: ssh root@$REMOTE_HOST "cd app && git branch -D temp && git checkout -b temp && git branch -D master && git fetch origin master && git checkout -b master origin/master"
    - script:
      name: start
      code: ssh root@$REMOTE_HOST "cd app && npm start"
